language: android
jdk: oraclejdk7
env:
  global:
  - ANDROID_TARGET=android-22
  - ANDROID_ABI=google_apis/armeabi-v7a
  - ANDROID_BUILD_TOOLS_VERSION=23.0.2
  - API_LEVEL=23
  - ANDROID_EMULATOR_API_LEVEL=22
android:
  components:
  - platform-tools
  - tools
  - build-tools-$ANDROID_BUILD_TOOLS_VERSION
  - android-$API_LEVEL
  - android-$ANDROID_EMULATOR_API_LEVEL
  - extra-android-support
  - extra-google-m2repository
  - extra-android-m2repository
  - addon-google_apis-google-$API_LEVEL
  - addon-google_apis-google-$ANDROID_EMULATOR_API_LEVEL
  - sys-img-armeabi-v7a-addon-google_apis-google-$ANDROID_EMULATOR_API_LEVEL
before_install:
- chmod +x gradlew
- echo no | android create avd --force -n test -t "Google Inc.:Google APIs:"$ANDROID_EMULATOR_API_LEVEL
  --abi $ANDROID_ABI
- emulator -avd test -no-skin -no-audio -no-window &
- adb wait-for-device
- adb shell input keyevent 82 &
script: "./gradlew connectedAndroidTest"
after_success:
- mv ./app/build/outputs/apk/app-debug.apk ./app/build/outputs/apk/HypixelStatistics-debug.apk
- ls ./app/build/outputs/apk/
deploy:
  provider: releases
  api_key: "$OAUTH_KEY"
  file: "./app/build/outputs/apk/HypixelStatistics-debug.apk"
  skip_cleanup: true
  on:
    tags: true
notifications:
  irc:
    channels:
    - chat.freenode.net#itachi1706mc
    - irc.esper.net#itachi1706
    on_success: always
    on_failure: always
    template:
    - "%{repository}#%{build_number} (%{branch} - %{commit} : %{author}): %{commit_subject}"
    - 'Build Status : %{message}'
    - 'Change view : %{compare_url}'
    - 'Build details : %{build_url}'
  email:
    recipients:
    - "$PRIVATE_EMAIL"
    on_success: change
    on_failure: always
  slack:
    secure: OEHl6mujKhD9mlbza1oGAwiB+rtbM8UkuJuojkFftYuz4iFK/lZi5iEAAKT69Cj8xKqV0pheM1trwjpMZ5N4Uc5lK4F/JupmvT2a6dWobYTer4jHkKxamwEWxHsfAUoNSxNFYKfpJvgMmeM8sAdY2FeBTB2j5Nupt8OW7k9N9fw=
